--------------------------------------------------------
--  File created - Monday-April-25-2016   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Procedure POPULATE_RSS_ERDB_RESULTS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE PROCEDURE "VGER_SUPPORT"."POPULATE_RSS_ERDB_RESULTS" 
AS
BEGIN

	 EXECUTE IMMEDIATE 'TRUNCATE TABLE VGER_SUPPORT.UCLADB_RSS_ERDB_RESULTS REUSE STORAGE';

         EXECUTE IMMEDIATE 'TRUNCATE TABLE VGER_SUPPORT.MOODLE_NEW_ITEMS REUSE STORAGE';

         EXECUTE IMMEDIATE 'TRUNCATE TABLE VGER_SUPPORT.UCLADB_RSS_LAW_RESULTS REUSE STORAGE';

	 EXECUTE IMMEDIATE 'INSERT INTO VGER_SUPPORT.UCLADB_RSS_ERDB_RESULTS(SUBJECT,' ||
                           'LOCATION,CALL_NUMBER,SORT_CALL_NUMBER,ADDED_DATE,BIB_ID,' ||
                           'LANGUAGE_CODE,LANGUAGE,EDITION,IMPRINT,SERIES,AUTHOR,' ||
                           'TITLE,PUB_YEAR,BIB_SUBJECTS,LOCATION_CODE, CALL_NO_TYPE) SELECT ' ||
                           'SUBJECT,LOCATION,CALL_NUMBER,SORT_CALL_NUMBER,ADDED_DATE,' || 
                           'BIB_ID,LANGUAGE_CODE,LANGUAGE,EDITION,IMPRINT,SERIES,' || 
                           'AUTHOR,TITLE,PUB_YEAR,BIB_SUBJECTS,LOCATION_CODE, CALL_NO_TYPE ' || 
                           'FROM VGER_SUPPORT.UCLADB_RSS_MARC WHERE added_date BETWEEN ' ||
                           'TRUNC(SYSDATE - 5) AND TRUNC(SYSDATE - 2)';

	 EXECUTE IMMEDIATE 'INSERT INTO VGER_SUPPORT.MOODLE_NEW_ITEMS(BIB_ID,' || 
                           'SHORT_TITLE,FULL_TITLE,ADDED_DATE,SUBJECT,LINK,' || 
                           'LINK_TEXT,ITEM_ID,PUBLISHER_DATE) SELECT BIB_ID,' || 
                           'SHORT_TITLE,FULL_TITLE,ADDED_DATE,SUBJECT,LINK,' || 
                           'LINK_TEXT,ITEM_ID,PUBLISHER_DATE FROM VGER_SUPPORT.MOODLE_NEW_ITEMS_VW' ||
	 		   ' MINUS SELECT BIB_ID,SHORT_TITLE,FULL_TITLE,ADDED_DATE,' || 
                           'SUBJECT,LINK,LINK_TEXT,ITEM_ID,PUBLISHER_DATE ' || 
                           'FROM VGER_SUPPORT.MOODLE_NEW_ITEMS';

	 EXECUTE IMMEDIATE 'INSERT INTO VGER_SUPPORT.UCLADB_RSS_LAW_RESULTS(' || 
                           'LOCATION,LOCATION_CODE,CALL_NO_TYPE,CALL_NUMBER,' ||
                           'SORT_CALL_NUMBER,ADDED_DATE,BIB_ID,LANGUAGE_CODE,LANGUAGE,' || 
                           'EDITION,IMPRINT,SERIES,AUTHOR,TITLE,PUB_YEAR,BIB_SUBJECTS,URL) SELECT ' ||
                           'LOCATION,LOCATION_CODE,CALL_NO_TYPE,CALL_NUMBER,' || 
                           'SORT_CALL_NUMBER,ADDED_DATE,BIB_ID,LANGUAGE_CODE,LANGUAGE,' || 
                           'EDITION,IMPRINT,SERIES,AUTHOR,TITLE,PUB_YEAR,BIB_SUBJECTS,URL ' || 
                           'FROM VGER_SUPPORT.UCLADB_RSS_LAW2';
END;

/
